
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1 DistilBERT o RoBERTa-base fine-tuned &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'DistilBERT';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2: Word2Vec + BiLSTM" href="Word2Vec.html" />
    <link rel="prev" title="EDA" href="EDA.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="EDA.html">EDA</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">1	DistilBERT o RoBERTa-base fine-tuned</a></li>
<li class="toctree-l1"><a class="reference internal" href="Word2Vec.html">2: Word2Vec + BiLSTM</a></li>
<li class="toctree-l1"><a class="reference internal" href="CNN.html">3. CNN-1D para texto (con embeddings preentrenados)</a></li>
<li class="toctree-l1"><a class="reference internal" href="TF.html">TF-IDF + XGBoost (GPU version)</a></li>
<li class="toctree-l1"><a class="reference internal" href="FastText.html">5. FastText (entrenamiento local con GPU/CPU)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FDistilBERT.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/DistilBERT.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>1	DistilBERT o RoBERTa-base fine-tuned</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="distilbert-o-roberta-base-fine-tuned">
<h1>1	DistilBERT o RoBERTa-base fine-tuned<a class="headerlink" href="#distilbert-o-roberta-base-fine-tuned" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span><span class="o">,</span><span class="w"> </span><span class="nn">platform</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CUDA disponible:&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPUs detectadas:&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">device_count</span><span class="p">())</span>
<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPU 0:&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CUDA ver:&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">cuda</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cuDNN ver:&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">version</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CUDA disponible: True
GPUs detectadas: 1
GPU 0: NVIDIA GeForce RTX 3050 6GB Laptop GPU
CUDA ver: 12.1
cuDNN ver: 90100
</pre></div>
</div>
</div>
</div>
<p>En este bloque se importa librerías básicas, define las rutas del proyecto y del CSV, indica qué columnas contienen el texto (Resume_str) y la etiqueta (Category), y configura el modelo base que se descargará del Hugging Face Hub (distilbert-base-uncased) junto con la carpeta donde se guardarán resultados y checkpoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Ruta a tu proyecto y dataset (Windows)</span>
<span class="n">PROJECT_DIR</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\elias\OneDrive\Desktop\MachineLearning\JBOOKS\Project3DL2&quot;</span>
<span class="n">DATA_PATH</span>   <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s2">\jarvis-calling-hiring-contest\Resume\Resume.csv&quot;</span>

<span class="c1"># Columnas del dataset</span>
<span class="n">TEXT_COL</span>  <span class="o">=</span> <span class="s2">&quot;Resume_str&quot;</span>
<span class="n">LABEL_COL</span> <span class="o">=</span> <span class="s2">&quot;Category&quot;</span>

<span class="c1"># Modelo desde el Hub (no local)</span>
<span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s2">&quot;distilbert-base-uncased&quot;</span>
<span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PROJECT_DIR</span><span class="si">}</span><span class="s2">\results_distilbert&quot;</span>

<span class="c1"># Tokenización</span>
<span class="n">MAX_LEN</span>   <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># sube a 512 si tienes VRAM</span>
<span class="n">SEED</span>      <span class="o">=</span> <span class="mi">42</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Este bloque carga el CSV, limpia filas sin texto o etiqueta y divide el dataset en tres partes: entrenamiento (80%), validación (10%) y prueba (10%). La división es estratificada por Category, es decir, mantiene la misma proporción de clases en cada split para evitar sesgos y hacer comparables las métricas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">TEXT_COL</span><span class="p">,</span> <span class="n">LABEL_COL</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">train_df</span><span class="p">,</span> <span class="n">temp_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">temp_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">temp_df</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;train&quot;</span><span class="p">,</span><span class="n">train_df</span><span class="p">),(</span><span class="s2">&quot;val&quot;</span><span class="p">,</span><span class="n">val_df</span><span class="p">),(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">test_df</span><span class="p">)]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>train (1987, 4)
val (248, 4)
test (249, 4)
</pre></div>
</div>
</div>
</div>
<p>Este bloque toma el conjunto de clases del dataset completo, lo ordena y construye label2id (de nombre de clase a índice) y id2label (de índice a nombre), junto con NUM_CLASSES.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mapeo consistente en todos los splits</span>
<span class="n">all_labels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">label2id</span> <span class="o">=</span> <span class="p">{</span><span class="n">lbl</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_labels</span><span class="p">)}</span>
<span class="n">id2label</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">lbl</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="n">label2id</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">NUM_CLASSES</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">label2id</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NUM_CLASSES =&quot;</span><span class="p">,</span> <span class="n">NUM_CLASSES</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ejemplo mapeo:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">label2id</span><span class="o">.</span><span class="n">items</span><span class="p">())[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NUM_CLASSES = 24
Ejemplo mapeo: [(&#39;ACCOUNTANT&#39;, 0), (&#39;ADVOCATE&#39;, 1), (&#39;AGRICULTURE&#39;, 2), (&#39;APPAREL&#39;, 3), (&#39;ARTS&#39;, 4)]
</pre></div>
</div>
</div>
</div>
<p>Aquí se prepara la tokenización con el tokenizer de Hugging Face para MODEL_NAME y define dos utilidades: tokenize_texts recibe una lista de textos y los convierte en secuencias de ids con su attention mask, aplicando padding/truncation a max_len para que todos tengan la misma longitud; devuelve numpy arrays (int32 para input_ids y int8 para la máscara) listos para crear datasets o tensores de PyTorch. labels_to_ids transforma las etiquetas de texto a sus índices numéricos usando el mapeo label2id, de modo que el modelo trabaje con clases enteras coherentes con lo definido antes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoTokenizer</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">MODEL_NAME</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">tokenize_texts</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">texts</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;max_length&quot;</span><span class="p">,</span>
        <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="n">max_len</span><span class="p">,</span>
        <span class="n">return_attention_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">return_tensors</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># devolvemos listas; luego convertimos a np</span>
    <span class="p">)</span>
    <span class="c1"># conv a numpy arrays</span>
    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">enc</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">enc</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span>

<span class="k">def</span><span class="w"> </span><span class="nf">labels_to_ids</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">label2id</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Este bloque tokeniza y etiqueta cada split por separado usando el mismo tokenizer y MAX_LEN: para train/val/test genera input_ids (ids de tokens), attention_mask (1 donde hay token real, 0 en padding) y labels (índices de clase), todo en numpy. Empaqueta cada split en un diccionario con el formato que espera Hugging Face ({“input_ids”, “attention_mask”, “labels”}) y muestra las dimensiones para verificar que el número de filas coincide con cada split y que todas las secuencias quedaron del mismo largo</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train</span>
<span class="n">tr_input_ids</span><span class="p">,</span> <span class="n">tr_att</span> <span class="o">=</span> <span class="n">tokenize_texts</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="n">TEXT_COL</span><span class="p">],</span> <span class="n">max_len</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">)</span>
<span class="n">tr_labels</span> <span class="o">=</span> <span class="n">labels_to_ids</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">])</span>

<span class="c1"># Val</span>
<span class="n">va_input_ids</span><span class="p">,</span> <span class="n">va_att</span> <span class="o">=</span> <span class="n">tokenize_texts</span><span class="p">(</span><span class="n">val_df</span><span class="p">[</span><span class="n">TEXT_COL</span><span class="p">],</span> <span class="n">max_len</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">)</span>
<span class="n">va_labels</span> <span class="o">=</span> <span class="n">labels_to_ids</span><span class="p">(</span><span class="n">val_df</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">])</span>

<span class="c1"># Test</span>
<span class="n">te_input_ids</span><span class="p">,</span> <span class="n">te_att</span> <span class="o">=</span> <span class="n">tokenize_texts</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="n">TEXT_COL</span><span class="p">],</span> <span class="n">max_len</span><span class="o">=</span><span class="n">MAX_LEN</span><span class="p">)</span>
<span class="n">te_labels</span> <span class="o">=</span> <span class="n">labels_to_ids</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="n">LABEL_COL</span><span class="p">])</span>

<span class="c1"># Estructuras dict &quot;como si&quot; vinieran de .npz</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;input_ids&quot;</span><span class="p">:</span> <span class="n">tr_input_ids</span><span class="p">,</span>
    <span class="s2">&quot;attention_mask&quot;</span><span class="p">:</span> <span class="n">tr_att</span><span class="p">,</span>
    <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">tr_labels</span>
<span class="p">}</span>
<span class="n">val_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;input_ids&quot;</span><span class="p">:</span> <span class="n">va_input_ids</span><span class="p">,</span>
    <span class="s2">&quot;attention_mask&quot;</span><span class="p">:</span> <span class="n">va_att</span><span class="p">,</span>
    <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">va_labels</span>
<span class="p">}</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;input_ids&quot;</span><span class="p">:</span> <span class="n">te_input_ids</span><span class="p">,</span>
    <span class="s2">&quot;attention_mask&quot;</span><span class="p">:</span> <span class="n">te_att</span><span class="p">,</span>
    <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">te_labels</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;train&quot;</span><span class="p">,</span><span class="n">train_data</span><span class="p">),(</span><span class="s2">&quot;val&quot;</span><span class="p">,</span><span class="n">val_data</span><span class="p">),(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">test_data</span><span class="p">)]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>train {&#39;input_ids&#39;: (1987, 512), &#39;attention_mask&#39;: (1987, 512), &#39;labels&#39;: (1987,)}
val {&#39;input_ids&#39;: (248, 512), &#39;attention_mask&#39;: (248, 512), &#39;labels&#39;: (248,)}
test {&#39;input_ids&#39;: (249, 512), &#39;attention_mask&#39;: (249, 512), &#39;labels&#39;: (249,)}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">val_dataset</span>   <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">val_data</span><span class="p">)</span>
<span class="n">test_dataset_hf</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>

<span class="n">train_dataset</span><span class="p">,</span> <span class="n">val_dataset</span><span class="p">,</span> <span class="n">test_dataset_hf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Dataset({
     features: [&#39;input_ids&#39;, &#39;attention_mask&#39;, &#39;labels&#39;],
     num_rows: 1987
 }),
 Dataset({
     features: [&#39;input_ids&#39;, &#39;attention_mask&#39;, &#39;labels&#39;],
     num_rows: 248
 }),
 Dataset({
     features: [&#39;input_ids&#39;, &#39;attention_mask&#39;, &#39;labels&#39;],
     num_rows: 249
 }))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataCollatorWithPadding</span>
<span class="n">data_collator</span> <span class="o">=</span> <span class="n">DataCollatorWithPadding</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_seed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.utils.class_weight</span><span class="w"> </span><span class="kn">import</span> <span class="n">compute_class_weight</span>

<span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># extrae labels de train para ponderar la loss si hay desbalance</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">])</span>
<span class="n">classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_train</span><span class="p">)))</span>
<span class="n">cw</span> <span class="o">=</span> <span class="n">compute_class_weight</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">class_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">cw</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Class weights shape:&quot;</span><span class="p">,</span> <span class="n">class_weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Class weights shape: torch.Size([24])
</pre></div>
</div>
</div>
</div>
<p>Este bloque define la función de métricas que usará el Trainer: a partir de los logits predichos y las etiquetas verdaderas, obtiene las clases con argmax y calcula accuracy, precision, recall y F1 con promedio macro (cada clase pesa igual, útil con desbalance). Además, cuando es posible, transforma los logits en probabilidades con softmax para computar un ROC-AUC macro (one-vs-rest) en problemas multiclase. El resultado se devuelve como un diccionario que el Trainer registrará en validación/evaluación</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_recall_fscore_support</span><span class="p">,</span> <span class="n">roc_auc_score</span>

<span class="n">num_labels</span> <span class="o">=</span> <span class="n">NUM_CLASSES</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_metrics</span><span class="p">(</span><span class="n">eval_pred</span><span class="p">):</span>
    <span class="n">logits</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">eval_pred</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_fscore_support</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">acc</span><span class="p">,</span>
        <span class="s2">&quot;precision_macro&quot;</span><span class="p">:</span> <span class="n">prec</span><span class="p">,</span>
        <span class="s2">&quot;recall_macro&quot;</span><span class="p">:</span> <span class="n">rec</span><span class="p">,</span>
        <span class="s2">&quot;f1_macro&quot;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># ROC-AUC macro OVR (requiere probabilidades)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">logits</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">num_labels</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;roc_auc_macro_ovr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">probs</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s2">&quot;ovr&quot;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<p>Este bloque descarga desde el Hub el modelo DistilBERT ya preparado para clasificación de secuencias, configurándole el número de clases y el mapeo id↔label, y luego lo envía al dispositivo disponible (GPu).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoModelForSequenceClassification</span><span class="p">,</span> <span class="n">AutoTokenizer</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">MODEL_NAME</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
    <span class="n">MODEL_NAME</span><span class="p">,</span>
    <span class="n">num_labels</span><span class="o">=</span><span class="n">NUM_CLASSES</span><span class="p">,</span>
    <span class="n">id2label</span><span class="o">=</span><span class="n">id2label</span><span class="p">,</span>
    <span class="n">label2id</span><span class="o">=</span><span class="n">label2id</span><span class="p">,</span>
    <span class="n">torch_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>   <span class="c1"># AMP lo gestiona durante el train</span>
<span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modelo:&quot;</span><span class="p">,</span> <span class="n">MODEL_NAME</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dispositivo:&quot;</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPU:&quot;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`torch_dtype` is deprecated! Use `dtype` instead!
Some weights of DistilBertForSequenceClassification were not initialized from the model checkpoint at distilbert-base-uncased and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;, &#39;pre_classifier.bias&#39;, &#39;pre_classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo: distilbert-base-uncased
Dispositivo: cuda:0
GPU: NVIDIA GeForce RTX 3050 6GB Laptop GPU
</pre></div>
</div>
</div>
</div>
<p>Este bloque construye de forma compatible con distintas versiones de transformers los TrainingArguments para entrenar DistilBERT.</p>
<p>Detecta dinámicamente qué nombres de parámetros se admiten y los alinea a epoch para que evaluación y guardado ocurran al final de cada época, habilitando load_best_model_at_end=True y seleccionando f1_macro como métrica para escoger el mejor checkpoint.</p>
<p>También fija hiperparámetros estándar (batch, learning_rate, épocas, weight_decay, warmup_ratio)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bloque E (compat v2): TrainingArguments con alias y estrategias alineadas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span><span class="o">,</span><span class="w"> </span><span class="nn">transformers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TrainingArguments</span><span class="p">,</span> <span class="n">Trainer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;transformers version:&quot;</span><span class="p">,</span> <span class="n">transformers</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="n">BATCH</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">LR</span> <span class="o">=</span> <span class="mf">2e-5</span>
<span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">WEIGHT_DECAY</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">WARMUP_RATIO</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_training_args</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">fp16_flag</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">TrainingArguments</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;output_dir&quot;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
        <span class="s2">&quot;per_device_train_batch_size&quot;</span><span class="p">:</span> <span class="n">BATCH</span><span class="p">,</span>
        <span class="s2">&quot;per_device_eval_batch_size&quot;</span><span class="p">:</span> <span class="n">BATCH</span><span class="p">,</span>
        <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="n">LR</span><span class="p">,</span>
        <span class="s2">&quot;num_train_epochs&quot;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="n">WEIGHT_DECAY</span><span class="p">,</span>
        <span class="s2">&quot;logging_steps&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Detecta nombres soportados</span>
    <span class="n">eval_key</span> <span class="o">=</span> <span class="s2">&quot;evaluation_strategy&quot;</span> <span class="k">if</span> <span class="s2">&quot;evaluation_strategy&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;eval_strategy&quot;</span> <span class="k">if</span> <span class="s2">&quot;eval_strategy&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">save_key</span> <span class="o">=</span> <span class="s2">&quot;save_strategy&quot;</span> <span class="k">if</span> <span class="s2">&quot;save_strategy&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">eval_key</span> <span class="ow">and</span> <span class="n">save_key</span><span class="p">:</span>
        <span class="n">kw</span><span class="p">[</span><span class="n">eval_key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;epoch&quot;</span>
        <span class="n">kw</span><span class="p">[</span><span class="n">save_key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;epoch&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;load_best_model_at_end&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;load_best_model_at_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;metric_for_best_model&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;metric_for_best_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;f1_macro&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;greater_is_better&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;greater_is_better&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fallback si tu versión no tiene esas claves</span>
        <span class="k">if</span> <span class="s2">&quot;do_eval&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;do_eval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;eval_steps&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;eval_steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="k">if</span> <span class="s2">&quot;save_steps&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;save_steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="k">if</span> <span class="s2">&quot;load_best_model_at_end&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;load_best_model_at_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s2">&quot;warmup_ratio&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;warmup_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WARMUP_RATIO</span>
    <span class="k">if</span> <span class="s2">&quot;report_to&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;report_to&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;fp16&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;fp16&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fp16_flag</span>
    <span class="k">if</span> <span class="s2">&quot;save_total_limit&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s2">&quot;save_total_limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">TrainingArguments</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">make_training_args</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">())</span>

<span class="c1"># (opcional) Verifica que quedaron alineadas</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eval_strategy:&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;evaluation_strategy&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;eval_strategy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;save_strategy:&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;save_strategy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;load_best_model_at_end:&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;load_best_model_at_end&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>transformers version: 4.57.1
eval_strategy: IntervalStrategy.EPOCH
save_strategy: SaveStrategy.EPOCH
load_best_model_at_end: True
</pre></div>
</div>
</div>
</div>
<p>Este bloque crea un Trainer personalizado que aplica pesos por clase para combatir el desbalance: WeightedTrainer sobreescribe compute_loss y calcula la pérdida con CrossEntropyLoss(weight=class_weights), de modo que las clases minoritarias cuenten más.</p>
<p>Luego instancia el entrenador con el modelo, los TrainingArguments ya definidos, los datasets de train/val, el tokenizer, un data collator simple (padding fijo), y la función compute_metrics que reporta f1_macro. También añade EarlyStopping con paciencia 2 épocas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Trainer</span><span class="p">,</span> <span class="n">EarlyStoppingCallback</span><span class="p">,</span> <span class="n">default_data_collator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="c1"># Versión compatible con transformers&gt;=4.57.* (acepta num_items_in_batch)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WeightedTrainer</span><span class="p">(</span><span class="n">Trainer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_weights</span> <span class="o">=</span> <span class="n">class_weights</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">return_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_items_in_batch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logits&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_weights</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">logits</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">loss_fct</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">cw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loss_fct</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fct</span><span class="p">(</span><span class="n">logits</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_labels</span><span class="p">),</span> <span class="n">labels</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span> <span class="k">if</span> <span class="n">return_outputs</span> <span class="k">else</span> <span class="n">loss</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">WeightedTrainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>                               <span class="c1"># tus TrainingArguments ya creados</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
    <span class="n">eval_dataset</span><span class="o">=</span><span class="n">val_dataset</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">data_collator</span><span class="o">=</span><span class="n">default_data_collator</span><span class="p">,</span>     <span class="c1"># tenemos padding fijo, OK</span>
    <span class="n">compute_metrics</span><span class="o">=</span><span class="n">compute_metrics</span><span class="p">,</span>         <span class="c1"># devuelve &#39;f1_macro&#39;</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">EarlyStoppingCallback</span><span class="p">(</span><span class="n">early_stopping_patience</span><span class="o">=</span><span class="mi">2</span><span class="p">)],</span>
    <span class="n">class_weights</span><span class="o">=</span><span class="n">class_weights</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best checkpoint:&quot;</span><span class="p">,</span> <span class="n">trainer</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">best_model_checkpoint</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    <div>
      
      <progress value='1250' max='1250' style='width:300px; height:20px; vertical-align: middle;'></progress>
      [1250/1250 06:51, Epoch 10/10]
    </div>
    <table border="1" class="dataframe">
  <thead>
 <tr style="text-align: left;">
      <th>Epoch</th>
      <th>Training Loss</th>
      <th>Validation Loss</th>
      <th>Accuracy</th>
      <th>Precision Macro</th>
      <th>Recall Macro</th>
      <th>F1 Macro</th>
      <th>Roc Auc Macro Ovr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>3.146900</td>
      <td>2.808589</td>
      <td>0.641129</td>
      <td>0.604431</td>
      <td>0.586129</td>
      <td>0.550388</td>
      <td>0.900262</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1.828000</td>
      <td>1.573989</td>
      <td>0.774194</td>
      <td>0.692098</td>
      <td>0.710263</td>
      <td>0.675693</td>
      <td>0.966272</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.168200</td>
      <td>1.034877</td>
      <td>0.826613</td>
      <td>0.758835</td>
      <td>0.769093</td>
      <td>0.757728</td>
      <td>0.979553</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.811200</td>
      <td>0.830288</td>
      <td>0.858871</td>
      <td>0.863126</td>
      <td>0.822799</td>
      <td>0.831199</td>
      <td>0.981458</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.697600</td>
      <td>0.750771</td>
      <td>0.842742</td>
      <td>0.823928</td>
      <td>0.807982</td>
      <td>0.809283</td>
      <td>0.983340</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.476400</td>
      <td>0.705924</td>
      <td>0.862903</td>
      <td>0.850050</td>
      <td>0.828752</td>
      <td>0.832662</td>
      <td>0.978956</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.427300</td>
      <td>0.638462</td>
      <td>0.875000</td>
      <td>0.854070</td>
      <td>0.846807</td>
      <td>0.845840</td>
      <td>0.982503</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.343700</td>
      <td>0.640584</td>
      <td>0.862903</td>
      <td>0.867696</td>
      <td>0.841252</td>
      <td>0.847267</td>
      <td>0.983913</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.301000</td>
      <td>0.657885</td>
      <td>0.862903</td>
      <td>0.838897</td>
      <td>0.835381</td>
      <td>0.834013</td>
      <td>0.981815</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.256300</td>
      <td>0.658880</td>
      <td>0.866935</td>
      <td>0.866633</td>
      <td>0.845797</td>
      <td>0.848427</td>
      <td>0.981193</td>
    </tr>
  </tbody>
</table><p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TrainOutput(global_step=1250, training_loss=0.9958160949707031, metrics={&#39;train_runtime&#39;: 412.8377, &#39;train_samples_per_second&#39;: 48.13, &#39;train_steps_per_second&#39;: 3.028, &#39;total_flos&#39;: 2633159896842240.0, &#39;train_loss&#39;: 0.9958160949707031, &#39;epoch&#39;: 10.0})
Best checkpoint: C:\Users\elias\OneDrive\Desktop\MachineLearning\JBOOKS\Project3DL2\results_distilbert\checkpoint-1250
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span><span class="o">,</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">torch</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;== Eval en validación ==&quot;</span><span class="p">)</span>
<span class="n">metrics_val</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">metrics_val</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">== Eval en test ==&quot;</span><span class="p">)</span>
<span class="n">pred_test</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_dataset_hf</span><span class="p">)</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">pred_test</span><span class="o">.</span><span class="n">label_ids</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">pred_test</span><span class="o">.</span><span class="n">predictions</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_prob</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>== Eval en validación ==
</pre></div>
</div>
<div class="output text_html"></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>eval_loss                    0.658880
eval_accuracy                0.866935
eval_precision_macro         0.866633
eval_recall_macro            0.845797
eval_f1_macro                0.848427
eval_roc_auc_macro_ovr       0.981193
eval_runtime                 1.400000
eval_samples_per_second    177.139000
eval_steps_per_second       11.428000
epoch                       10.000000
dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>== Eval en test ==
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">== Eval en test ==&quot;</span><span class="p">)</span>

<span class="n">rep</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span>
    <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
    <span class="n">target_names</span><span class="o">=</span><span class="p">[</span><span class="n">id2label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">id2label</span><span class="p">))],</span>
    <span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">df_rep</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_rep</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>== Eval en test ==
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>precision</th>
      <th>recall</th>
      <th>f1-score</th>
      <th>support</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ACCOUNTANT</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>ADVOCATE</th>
      <td>0.909091</td>
      <td>0.833333</td>
      <td>0.869565</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>AGRICULTURE</th>
      <td>0.857143</td>
      <td>1.000000</td>
      <td>0.923077</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>APPAREL</th>
      <td>0.545455</td>
      <td>0.666667</td>
      <td>0.600000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>ARTS</th>
      <td>0.714286</td>
      <td>0.454545</td>
      <td>0.555556</td>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>AUTOMOBILE</th>
      <td>0.500000</td>
      <td>0.666667</td>
      <td>0.571429</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>AVIATION</th>
      <td>0.923077</td>
      <td>1.000000</td>
      <td>0.960000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>BANKING</th>
      <td>1.000000</td>
      <td>0.666667</td>
      <td>0.800000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>BPO</th>
      <td>0.200000</td>
      <td>0.500000</td>
      <td>0.285714</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>BUSINESS-DEVELOPMENT</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>CHEF</th>
      <td>0.900000</td>
      <td>0.750000</td>
      <td>0.818182</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>CONSTRUCTION</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>CONSULTANT</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>DESIGNER</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>10.000000</td>
    </tr>
    <tr>
      <th>DIGITAL-MEDIA</th>
      <td>0.857143</td>
      <td>0.666667</td>
      <td>0.750000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>ENGINEERING</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>FINANCE</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>FITNESS</th>
      <td>0.769231</td>
      <td>0.833333</td>
      <td>0.800000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>HEALTHCARE</th>
      <td>0.727273</td>
      <td>0.666667</td>
      <td>0.695652</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>HR</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>INFORMATION-TECHNOLOGY</th>
      <td>0.916667</td>
      <td>0.916667</td>
      <td>0.916667</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>PUBLIC-RELATIONS</th>
      <td>0.846154</td>
      <td>1.000000</td>
      <td>0.916667</td>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>SALES</th>
      <td>0.846154</td>
      <td>0.916667</td>
      <td>0.880000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>TEACHER</th>
      <td>0.833333</td>
      <td>1.000000</td>
      <td>0.909091</td>
      <td>10.000000</td>
    </tr>
    <tr>
      <th>accuracy</th>
      <td>0.875502</td>
      <td>0.875502</td>
      <td>0.875502</td>
      <td>0.875502</td>
    </tr>
    <tr>
      <th>macro avg</th>
      <td>0.847709</td>
      <td>0.855745</td>
      <td>0.843817</td>
      <td>249.000000</td>
    </tr>
    <tr>
      <th>weighted avg</th>
      <td>0.887800</td>
      <td>0.875502</td>
      <td>0.876066</td>
      <td>249.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusión con figura más grande y anotaciones</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>  <span class="c1"># ajustar tamaño aquí</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Matriz de confusión (test)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">id2label</span><span class="p">))</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">id2label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Predicho&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Añadir los números en cada celda</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fmt</span><span class="p">),</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span> <span class="k">if</span> <span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a3a2721398a4e337c90dc21d0ddab22bfe71faef377995932a30d857067cd9c9.png" src="_images/a3a2721398a4e337c90dc21d0ddab22bfe71faef377995932a30d857067cd9c9.png" />
</div>
</div>
<p>La matriz de confusión es buena en general: la diagonal domina, señal de que el modelo acierta la mayoría de los casos por clase. Las confusiones aparecen sobre todo entre categorías parecidas o con vocabulario compartido (p. ej., Business-Development ↔ Sales, Information-Technology ↔ Engineering, Digital-Media ↔ Designer, HR/Public-Relations), y en clases con pocos ejemplos (BPO, Automobile, Agriculture), donde la dispersión es mayor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_auc_score</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">roc_macro_ovr</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s2">&quot;ovr&quot;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROC-AUC macro (OvR) en test:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">roc_macro_ovr</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROC-AUC no disponible:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ROC-AUC macro (OvR) en test: 0.9828
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">best_ckpt</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">best_model_checkpoint</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best checkpoint:&quot;</span><span class="p">,</span> <span class="n">best_ckpt</span><span class="p">)</span>

<span class="n">SAVE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">best_ckpt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">)</span>
    <span class="n">tokenizer</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">SAVE_DIR</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Guardado en:&quot;</span><span class="p">,</span> <span class="n">SAVE_DIR</span><span class="p">)</span>

<span class="c1"># Recarga (en otro notebook o más tarde):</span>
<span class="c1"># from transformers import AutoModelForSequenceClassification, AutoTokenizer</span>
<span class="c1"># model = AutoModelForSequenceClassification.from_pretrained(SAVE_DIR)</span>
<span class="c1"># tokenizer = AutoTokenizer.from_pretrained(SAVE_DIR)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best checkpoint: C:\Users\elias\OneDrive\Desktop\MachineLearning\JBOOKS\Project3DL2\results_distilbert\checkpoint-1250
Guardado en: C:\Users\elias\OneDrive\Desktop\MachineLearning\JBOOKS\Project3DL2\results_distilbert\best
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict_texts</span><span class="p">(</span><span class="n">text_list</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
        <span class="n">text_list</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;max_length&quot;</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">max_len</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
    <span class="p">)</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">enc</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">enc</span><span class="p">)</span><span class="o">.</span><span class="n">logits</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">id2label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pred</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">labels</span><span class="p">,</span> <span class="n">prob</span>

<span class="c1"># Ejemplo:</span>
<span class="n">labels</span><span class="p">,</span> <span class="n">prob</span> <span class="o">=</span> <span class="n">predict_texts</span><span class="p">([</span><span class="s2">&quot;Experienced data scientist with NLP background.&quot;</span><span class="p">])</span>
<span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prob</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;INFORMATION-TECHNOLOGY&#39;, 0.13628931)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 8. Curva ROC</span>
<span class="c1"># Import only the missing utilities</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">label_binarize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">softmax</span> <span class="k">as</span> <span class="n">_softmax</span>  <span class="c1"># fallback if probs not precomputed</span>

<span class="c1"># Prefer precomputed probabilities (y_prob). If not available, compute from pred_test.predictions logits.</span>
<span class="k">if</span> <span class="s2">&quot;y_prob&quot;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">y_prob</span>
<span class="k">elif</span> <span class="s2">&quot;pred_test&quot;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">_softmax</span><span class="p">(</span><span class="n">pred_test</span><span class="o">.</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No probability predictions found: ensure &#39;y_prob&#39; or &#39;pred_test&#39; is available.&quot;</span><span class="p">)</span>

<span class="c1"># y_true must be the ground-truth integer labels</span>
<span class="k">if</span> <span class="s2">&quot;y_true&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No true labels found: variable &#39;y_true&#39; is required.&quot;</span><span class="p">)</span>

<span class="n">labels_bin</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">NUM_CLASSES</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_CLASSES</span><span class="p">):</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">labels_bin</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">probs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Clase </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">id2label</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">) (AUC = </span><span class="si">{</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="w"> </span><span class="n">tpr</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;FPR&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;TPR&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Curvas ROC por clase&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/867765a3735492492baee9294086b31fa2c515b8f2cb6b60b58cd1f073abfdcf.png" src="_images/867765a3735492492baee9294086b31fa2c515b8f2cb6b60b58cd1f073abfdcf.png" />
</div>
</div>
<p>Las curvas ROC por clase están muy arriba y pegadas al eje izquierdo, con AUC≈1.0 en la mayoría de categorías y ~0.90–0.97 en unas pocas (p. ej., ARTS, HEALTHCARE), lo que indica que el modelo ordena bien los ejemplos correctos por puntaje aunque luego, al fijar un umbral, aún veamos errores en la matriz de confusión.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">torch</span><span class="o">,</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">average_precision_score</span>

<span class="c1"># 1) Predicciones en test</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_dataset_hf</span><span class="p">)</span>  <span class="c1"># usa tu Dataset de test</span>
<span class="n">logits</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">predictions</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="k">else</span> <span class="n">pred</span><span class="o">.</span><span class="n">predictions</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">label_ids</span>
<span class="n">probs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">logits</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="c1"># 2) Binariza etiquetas (one-vs-rest)</span>
<span class="n">y_true_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">NUM_CLASSES</span><span class="p">)[</span><span class="n">y_true</span><span class="p">]</span>

<span class="c1"># 3) Curvas PR y Average Precision por clase</span>
<span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">ap</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_CLASSES</span><span class="p">):</span>
    <span class="n">rec</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">prec</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_true_bin</span><span class="p">[:,</span> <span class="n">c</span><span class="p">],</span> <span class="n">probs</span><span class="p">[:,</span> <span class="n">c</span><span class="p">])</span>
    <span class="n">ap</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">y_true_bin</span><span class="p">[:,</span> <span class="n">c</span><span class="p">],</span> <span class="n">probs</span><span class="p">[:,</span> <span class="n">c</span><span class="p">])</span>

<span class="c1"># 4) Micro y Macro AP</span>
<span class="n">rec</span><span class="p">[</span><span class="s2">&quot;micro&quot;</span><span class="p">],</span> <span class="n">prec</span><span class="p">[</span><span class="s2">&quot;micro&quot;</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_true_bin</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">probs</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">ap</span><span class="p">[</span><span class="s2">&quot;micro&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">y_true_bin</span><span class="p">,</span> <span class="n">probs</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span><span class="p">)</span>
<span class="n">ap</span><span class="p">[</span><span class="s2">&quot;macro&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">y_true_bin</span><span class="p">,</span> <span class="n">probs</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>

<span class="c1"># 5) Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_CLASSES</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">prec</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">id2label</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="si">}</span><span class="s2"> (AP=</span><span class="si">{</span><span class="n">ap</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;micro&quot;</span><span class="p">],</span> <span class="n">prec</span><span class="p">[</span><span class="s2">&quot;micro&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;micro-average (AP=</span><span class="si">{</span><span class="n">ap</span><span class="p">[</span><span class="s1">&#39;micro&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Recall&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precision&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Curvas Precision–Recall por clase&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">({</span><span class="s2">&quot;AP_micro&quot;</span><span class="p">:</span> <span class="n">ap</span><span class="p">[</span><span class="s2">&quot;micro&quot;</span><span class="p">],</span> <span class="s2">&quot;AP_macro&quot;</span><span class="p">:</span> <span class="n">ap</span><span class="p">[</span><span class="s2">&quot;macro&quot;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"></div><img alt="_images/3039a0e8de8c5dc1b12f230e73f349acb19a98a50ff09effb67660c1a2595631.png" src="_images/3039a0e8de8c5dc1b12f230e73f349acb19a98a50ff09effb67660c1a2595631.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;AP_micro&#39;: 0.9325165782430903, &#39;AP_macro&#39;: 0.8954052789412777}
</pre></div>
</div>
</div>
</div>
<p>Las curvas PR confirman buen rendimiento global: el AP micro ≈ 0.93 y varias clases tienen AP≈1.00 (p. ej., Accountant, Agriculture, Aviation, Construction, Consultant, Designer, Engineering, Finance, HR, IT, Teacher), lo que indica que el modelo mantiene alta precisión al aumentar el recall. Las más flojas son BPO (0.54), Automobile (0.59), Arts (0.61), Healthcare (0.72), Apparel (0.75) y, en menor medida, Banking (0.83). En resumen: el modelo separa bien la mayoría de categorías, pero pierde calidad en las minoritarias o con vocabulario más genérico.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;y_true&quot;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;y_pred&quot;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
	<span class="n">errores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_true</span> <span class="o">!=</span> <span class="n">y_pred</span><span class="p">)</span>
	<span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
	<span class="n">accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">errores</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span>

	<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; RESUMEN DE ERRORES - DistilBERT&quot;</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Predicciones correctas: </span><span class="si">{</span><span class="n">total</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">errores</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Predicciones incorrectas: </span><span class="si">{</span><span class="n">errores</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Total de ejemplos: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Tasa de error: </span><span class="si">{</span><span class="p">(</span><span class="n">errores</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

	<span class="c1"># Imprimir classification report si está disponible</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Classification report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
									<span class="n">target_names</span><span class="o">=</span><span class="p">[</span><span class="n">id2label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_CLASSES</span><span class="p">)],</span>
									<span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
	<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se pudo generar el classification_report:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
	<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Variables &#39;y_true&#39; y &#39;y_pred&#39; no encontradas. Ejecuta la evaluación/predicción antes de este cell.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>============================================================
 RESUMEN DE ERRORES - DistilBERT
============================================================
 Predicciones correctas: 218
 Predicciones incorrectas: 31
 Total de ejemplos: 249
 Accuracy: 87.55%
 Tasa de error: 12.45%
============================================================

Classification report:

                        precision    recall  f1-score   support

            ACCOUNTANT     1.0000    1.0000    1.0000        12
              ADVOCATE     0.9091    0.8333    0.8696        12
           AGRICULTURE     0.8571    1.0000    0.9231         6
               APPAREL     0.5455    0.6667    0.6000         9
                  ARTS     0.7143    0.4545    0.5556        11
            AUTOMOBILE     0.5000    0.6667    0.5714         3
              AVIATION     0.9231    1.0000    0.9600        12
               BANKING     1.0000    0.6667    0.8000        12
                   BPO     0.2000    0.5000    0.2857         2
  BUSINESS-DEVELOPMENT     1.0000    1.0000    1.0000        12
                  CHEF     0.9000    0.7500    0.8182        12
          CONSTRUCTION     1.0000    1.0000    1.0000        11
            CONSULTANT     1.0000    1.0000    1.0000        12
              DESIGNER     1.0000    1.0000    1.0000        10
         DIGITAL-MEDIA     0.8571    0.6667    0.7500         9
           ENGINEERING     1.0000    1.0000    1.0000        12
               FINANCE     1.0000    1.0000    1.0000        12
               FITNESS     0.7692    0.8333    0.8000        12
            HEALTHCARE     0.7273    0.6667    0.6957        12
                    HR     1.0000    1.0000    1.0000        11
INFORMATION-TECHNOLOGY     0.9167    0.9167    0.9167        12
      PUBLIC-RELATIONS     0.8462    1.0000    0.9167        11
                 SALES     0.8462    0.9167    0.8800        12
               TEACHER     0.8333    1.0000    0.9091        10

              accuracy                         0.8755       249
             macro avg     0.8477    0.8557    0.8438       249
          weighted avg     0.8878    0.8755    0.8761       249
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="EDA.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">EDA</p>
      </div>
    </a>
    <a class="right-next"
       href="Word2Vec.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">2: Word2Vec + BiLSTM</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>